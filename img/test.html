<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Perfect No-Snap Marquee</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 40px;
  }
  .marquee {
    overflow: hidden;
    border: 2px solid #ccc;
    border-radius: 8px;
    background: #fff;
  }
  .marquee__track {
    display: flex;
    width: max-content; /* fit to content width */
    animation-name: scroll;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    animation-duration: var(--duration, 10s);
    will-change: transform;
  }
  .marquee__item {
    flex: 0 0 auto;
    padding: 0 40px;
    line-height: 60px;
    font-weight: bold;
    color: #333;
  }

  @keyframes scroll {
    from { transform: translateX(0); }
    to { transform: translateX(calc(var(--scroll-width) * -1px)); }
  }
</style>
</head>
<body>

<h2>Perfect Smooth Continuous Marquee</h2>

<div class="marquee" aria-label="Scrolling marquee banner" role="region">
  <div class="marquee__track" id="marquee-track">
    <!-- First set -->
    <div class="marquee__item">Item 1</div>
    <div class="marquee__item">Item 2</div>
    <div class="marquee__item">Item 3</div>
    <div class="marquee__item">Item 4</div>
    <div class="marquee__item">Item 5</div>

    <!-- Duplicate set -->
    <div class="marquee__item">Item 1</div>
    <div class="marquee__item">Item 2</div>
    <div class="marquee__item">Item 3</div>
    <div class="marquee__item">Item 4</div>
    <div class="marquee__item">Item 5</div>
  </div>
</div>

<script>
  const track = document.getElementById('marquee-track');
  const itemsCount = track.children.length / 2;

  // Get width of half the items (one full set)
  function updateMarquee() {
    let width = 0;
    for(let i = 0; i < itemsCount; i++) {
      width += track.children[i].offsetWidth;
    }

    // Add gaps/paddings between items (computed via CSS)
    // We'll get the gap by subtracting sum of widths from total width of the first set
    const firstSetWidth = 0;
    const firstSetElems = Array.from(track.children).slice(0, itemsCount);
    const totalFirstSetWidth = firstSetElems.reduce((acc, el) => acc + el.offsetWidth, 0);

    // Set CSS variables to be used in keyframes
    track.style.setProperty('--scroll-width', width);
    
    // Set animation duration based on speed (pixels per second)
    // Speed = 100px/s (adjust as you like)
    const speed = 100; 
    const duration = width / speed; // seconds
    track.style.setProperty('--duration', `${duration}s`);
  }

  window.addEventListener('load', updateMarquee);
  window.addEventListener('resize', updateMarquee);
</script>

</body>
</html>